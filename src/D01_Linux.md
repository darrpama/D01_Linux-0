# DO1_Linux darrpama

## Part 1. Установка ОС

**== Задание ==**

<br>

##### Установить **Ubuntu 20.04 Server LTS** без графического интерфейса.

<br>

**== Выполнение ==**

* Скриншот с выводом команды
`cat /etc/issue.`
![Версия ubuntu](images/P1-1.png)

<br>

## Part 2. Создание пользователя

**== Задание ==**

<br>

##### Создать пользователя, отличного от пользователя, который создавался при установке. Пользователь должен быть добавлен в группу `adm`.

<br>

**== Выполнение ==**

* Скриншот вызова команды для создания пользователя
![Создание пользователя](images/P2-1.png)
![Изменение группы пользователя](images/P2-2.png)
* Скриншот вызова команды `groups darrpama2` для проверки группы пользователя
![Подтверждение группы пользователя](images/P2-3.png)
* Скриншот вывода команды `cat /etc/passwd`
![Подтверждение создания пользователя](images/P2-4.png)

<br>

## Part 3. Настройка сети ОС

**== Задание ==**

<br>

##### Задать название машины вида user-1  
##### Установить временную зону, соответствующую вашему текущему местоположению.  
##### Вывести названия сетевых интерфейсов с помощью консольной команды.
- В отчёте дать объяснение наличию интерфейса lo.  
##### Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера. 
- В отчёте дать расшифровку DHCP.  
##### Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw). 
##### Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).  
##### Перезагрузить виртуальную машину. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.  

- В отчёте описать, что сделано для выполнения всех семи пунктов (можно как текстом, так и скриншотами).
- Успешно пропинговать удаленные хосты 1.1.1.1 и ya.ru и вставить в отчёт скрин с выводом команды. В выводе команды должна быть фраза "0% packet loss".

<br>

**== Выполнение ==**

* Задал название машины вида user-1 открыв с правами суперпользователя в vi файл /etc/hostname и изменив его содержимое с darrpama-server на user-1

* Установил временную зону, соответствующую текущему местоположению с помощью команды `sudo timedatectl set-timezone Europe/Moscow`. Проверил правильность вызовом `timedatectl`.
![Подтверждение смены временной зоны](images/P3-2.png)

* Вывел названия сетевых интерфейсов с помощью команды `ip link show`
![Вывод названий сетевых интерфейсов](images/P3-3.png)
* lo (loopback device) – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Он используется для отладки сетевых программ и запуска серверных приложений на локальной машине. С этим интерфейсом всегда связан адрес 127.0.0.1. У него есть dns-имя – localhost. Он может быть использован сетевым клиентским программным обеспечением, чтобы общаться с серверным приложением, расположенным на том же компьютере.

* Используя консольную команду `ip address` получил ip адрес устройства, на котором я работал от DHCP сервера - `10.0.2.15`
![Вывод сетевых интерфейсов и ip выданного DHCP сервером](images/P3-4.png)
* DHCP — протокол прикладного уровня модели TCP/IP, служит для назначения IP-адреса клиенту. Это следует из его названия — Dynamic Host Configuration Protocol. IP-адрес можно назначать вручную каждому клиенту, то есть компьютеру в локальной сети. DHCP-серверы централизованно управляют IP-адресами и связанными с ними сведениями и автоматически предоставляют их клиентам. Это позволяет настраивать параметры клиента сети на сервере, а не на каждом компьютере в отдельности.

* Определил и вывел на экран внешний ip-адрес шлюза (ip) с помощью команды `curl ifconfig.me/ip` - 178.207.154.253 и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw) с помощью команды `ip route | grep default` - 10.0.2.2.

* Задал статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовал публичный DNS сервер, например 1.1.1.1 или 8.8.8.8). Создал файл `02-networkd.yaml` и установил доступ к файлу командой `sudo chmod 777 02-networkd.yaml`. Отредактировал его с помощью vi и подтвердил изменения командой `sudo netplan apply`. gw теперь равен 10.0.2.5, публичные серверы = 1.1.1.1 и 8.8.8.8
![Конфигурация файла 02-networkd.yaml](images/P3-5.png)

* Перезагрузил виртуальную машину командой `shuitdown -r now`. Убедился, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте с помощью команд `resolvectl status` и `ip a`.
![Проверка статичных сетевых настроек](images/P3-6.png)

* Пропинговал сайт яндекса и 1.1.1.1.
![Проверка работы сети](images/P3-7.png)

<br>

## Part 4. Обновление ОС

**== Задание ==**

<br>

##### Обновить системные пакеты до последней на момент выполнения задания версии.

- После обновления системных пакетов, если ввести команду обновления повторно, должно появится сообщение, что обновления отсутствуют.
- Вставить скриншот с этим сообщением в отчёт.

<br>

**== Выполнение ==**

* Обновил информацию о пакетах выполнив `sudo apt-get update`
![Обновление информации о пакетах](images/P4-1.png)

* Установил обновления для пакетов выполнив `sudo apt-det upgrade`
![Установка пакетов](images/P4-2.png)

<br>

## Part 5. Использование команды **sudo**

**== Задание ==**

<br>

##### Разрешить пользователю, созданному в [Part 2], выполнять команду sudo.

- В отчёте объяснить *истинное* назначение команды sudo. 
- Поменять hostname ОС от имени пользователя, созданного в пункте 2 (используя sudo).
- Вставить скрин с изменённым hostname в отчёт.

**== Выполнение ==**

* sudo (англ. Substitute User and do, дословно «подменить пользователя и выполнить») — программа для системного администрирования UNIX-систем, позволяющая делегировать те или иные привилегированные ресурсы пользователям с ведением протокола работы. Основная идея — дать пользователям как можно меньше прав, при этом достаточных для решения поставленных задач. Команда sudo предоставляет возможность пользователям выполнять команды от имени суперпользователя root, либо других пользователей. Правила, используемые sudo для принятия решения о предоставлении доступа, находятся в файле /etc/sudoers.
В большинстве случаев грамотная настройка sudo делает небезопасную работу от имени суперпользователя ненужной. Все действия оказываются выполнимы из-под аккаунта пользователя, которому разрешено использовать sudo без ограничений. Имеется возможность запрещать и разрешать определённым пользователям или группам выполнение конкретного набора программ, а также разрешить выполнение определённых программ без необходимости ввода своего пароля.

* Командой `sudo usermod -a -G sudo darrpama2` разрешил пользователю использовать sudo
* Сменил пользователя командой `su - darrpama2`
* Изменил hostname `sudo vi /etc/hostname`
* Посмотрел результат `cat /etc/hostname`
![Результат смены hostname](images/P5-1.png)

<br>

## Part 6. Установка и настройка службы времени

**== Задание ==**

<br>

##### Настроить службу автоматической синхронизации времени.  

- Вывести время, часового пояса, в котором вы сейчас находитесь.
- Вывод следующей команды должен содержать `NTPSynchronized=yes`: \
  `timedatectl show`
- Вставить скрины с корректным временем и выводом команды в отчёт.

**== Выполнение ==**

* Установил NTP командой `sudo apt install systemd-timesyncd`

* Активировал NTP командой `sudo timedatectl set-ntp on`

* Вывод команды `timedatectl show`
![Результат timedatectl show](images/P6-1.png)

<br>

## Part 7. Установка и использование текстовых редакторов.

**== Задание ==**

<br>

##### Установить текстовые редакторы **VIM** (+ любые два по желанию **NANO**, **MCEDIT**, **JOE** и т.д.)  
##### Используя каждый из трех выбранных редакторов, создайте файл *test_X.txt*, где X -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений.  
- В отчёт вставьте скриншоты:
  - Из каждого редактора с содержимым файла перед закрытием.
- В отчёте укажите, что сделали для выхода с сохранением изменений.
##### Используя каждый из трех выбранных редакторов, откройте файл на редактирование, отредактируйте файл, заменив никнейм на строку "21 School 21", закройте файл без сохранения изменений.
- В отчёт вставьте скриншоты:
    - Из каждого редактора с содержимым файла после редактирования.
- В отчёте укажите, что сделали для выхода без сохранения изменений.
##### Используя каждый из трех выбранных редакторов, отредактируйте файл ещё раз (по аналогии с предыдущим пунктом), а затем освойте функции поиска по содержимому файла (слово) и замены слова на любое другое.
- В отчёт вставьте скриншоты:
    - Из каждого редактора с результатами поиска слова.
    - Из каждого редактора с командами, введёнными для замены слова на другое.

**== Выполнение ==**

* Используя команду `sudo apt install mcedit` установил текстовый редактор MCEDIT

##### Exercise 1:

* **VIM**

* Создаем файл с помощью команды `vim test_VIM.txt`

* Нажимаем на "i" в самом редакторе, для редактирования

* Пишу свой ник: "darrpama"

Для выхода с сохранением нажимем `Esc` вводим команду `:wq` и нажимаем `Enter`

![VIM](images/P7-1.png)<br>*VIM*<br>

<br>

* **NANO**

* Создаем файл с помощью команды `nano test_NANO.txt`

* Пишу свой ник: "darrpama"

* Для выхода с сохранением нажимаем комбинацию `command+x` вводим `Y` и нажимаем`Enter`

![NANO](images/P7-2.png)<br>*NANO*<br>

<br>

* **MCEDIT**

* Cоздаем файл с помощью команды `mcedit test_MCEDIT.txt`

* Пишу свой ник: "darrpama"

* Для выхода с сохранением нажимаем `Esc` и подтверждаем выход с сохранением

![MCEDIT](images/P7-3.png)<br>*MCEDIT*<br>

<br>

##### Exercise 2:

* **VIM**

* Открываем файл с помощью команды `vim test_VIM.txt`

* Нажимаем на "i" в самом редакторе, для редактирования

* Изменяем "darrpama" на "21 School 21"

* Для выхода без сохранения нажимаем `Esc` вводим команду `:q!` и нажимаем `Enter`

![VIM](images/P7-4.png)<br>*VIM*<br>

* **NANO**

* Открываем файл с помощью команды `nano test_NANO.txt`

* Изменяем "darrpama" на "21 School 21"

* Для выхода без сохранения нажимаем комбинацию `command+x` потом `N`

![NANO](images/P7-5.png)<br>*NANO*<br>

* **MCEDIT**

* Открываем файл с помощью команды `mcedit test_MCEDIT.txt`.

* Изменяем "darrpama" на "21 School 21"

* Для выхода без сохранения нажимаем `Esc` и подтверждаем выход без сохранения

![MCEDIT](images/P7-6.png)<br>*MCEDIT*<br>

##### Exercise 3:

* **VIM**

* Открываем файл с помощью команды `vim test_VIM.txt`

* Для поиска в VIM вводим `/darrpama` и искомое слово выделяется в самом редакторе

![VIM](images/P7-7.1.png)<br>*VIM*<br>

* Для замены слова в VIM вводим `:%s/darrpama/21 School 21` и слово "carnaget" заменяется на "21 School 21"

![VIM](images/P7-7.2.png)<br>*VIM*<br>

<br>

* **NANO**

* Открываем файл с помощью команды `nano test_nano.txt`

* Для поиска в NANO вводим `command + W`

![NANO](images/P7-7.3.png)<br>*NANO*<br>

* Для замены слова в NANO вводим `command + \`, пишем "darrpama", нажимаем `Enter`, пишем "21 School 21", нажимаем `Enter`, выбираем `Y`

![NANO](images/P7-7.4.png)<br>*NANO*<br>

<br>

* **MCEDIT**

* Открываем файл с помощью команды `mcedit test_MCEDIT.txt`.

* Для поиска нажимаем F7, пишем darrpama, стрелкой вниз переходим в меню, нажимаем А, нажимаем OK.

![MCEDIT](images/P7-7.5.png)<br>*MCEDIT*<br>

* Для замены слова в MCEDIT нажимаем `F4`, пишем "darrpama", во второй строке пишем 21 School 21, стрелкой вниз переходим в меню, нажимаем А, нажимаем O, нажимаем R.

![MCEDIT](images/P7-7.6.png)<br>*MCEDIT*<br>

<br>

## Part 8. Установка и базовая настройка сервиса **SSHD**

**== Задание ==**

<br>

##### Установить службу SSHd.  
##### Добавить автостарт службы при загрузке системы.  
##### Перенастроить службу SSHd на порт 2022.  
##### Используя команду ps, показать наличие процесса sshd. Для этого к команде нужно подобрать ключи.
- В отчёте объяснить значение команды и каждого ключа в ней.
##### Перезагрузить систему.
- В отчёте опишите, что сделали для выполнения всех пяти пунктов (можно как текстом, так и скриншотами).
- Вывод команды netstat -tan должен содержать  \
`tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN`  \
(если команды netstat нет, то ее нужно установить)
- Скрин с выводом команды вставить в отчёт.
- В отчёте объяснить значение ключей -tan, значение каждого столбца вывода, значение 0.0.0.0.

**== Выполнение ==**

* Устанавливаем службу SSHd командой `sudo apt install openssh-server`

* Проверяем наличие командой `ssh -V`
![SSH](images/P8-1.png)

* Добавляем автостарт службы SSHd командой `sudo update-rc.d ssh defaults`

* Изменяем порт SSHd командой `sudo vim /etc/ssh/sshd_config`

* Добавляем строку `Port 2022`
![Изменённый конфиг](images/P8-2.png)

* Используем команду `/etc/init.d/ssh restart` для того что бы изменения вступили в силу
![Вывод команды restart](images/P8-3.png)

Используем команду `ps -axfv | grep sshd` для проверки наличия процесса
![ssh процесс](images/P8-4.png)

* Команда `ps` показывает текущие процессы на сервере.

* Команда `grep` позволяет выдилить нужную нам информацию по процессам

* флаг -a оставляет все процессы, кроме лидеров сеансов и процессов, не связанных с терминалом

* флаг -x заставляет `ps` отображать список всех процессов, которыми вы владеете

* флаг -f выводит полноформатный список

* флаг -v выводит информацию о версии

<br>
* Устанавливаем *net-tools* `sudo apt install net-tools`

* Выполняем команду `netstat -tan`
![Выполнение команды netstat -tan](images/P8-5.png)

* Опция -a показывает состояние всех сокетов

* -n показывает ip адрес, а не сетевое имя

* -t показывает только tcp соединения

* столбец Proto - протокол, используемый сокетом

* столбец Recv-Q - количество байтов, не скопированных пользовательской программой, подключенной к этому сокету

* столбец Local Address - локальный адрес (имя локального хоста) и номер порта сокета

* стобец Foreign Address - удаленный адрес (имя удаленного хоста) и номер порта сокета

* стобец State - состояние сокета

* Перезагружаем систему командой `sudo reboot`

<br>

## Part 9. Установка и использование утилит **top**, **htop**

**== Задание ==**

<br>

##### Установить и запустить утилиты top и htop.  

- По выводу команды top определить и написать в отчёте:
  - uptime
  - количество авторизованных пользователей
  - общую загрузку системы
  - общее количество процессов
  - загрузку cpu
  - загрузку памяти
  - pid процесса занимающего больше всего памяти
  - pid процесса, занимающего больше всего процессорного времени
- В отчёт вставить скрин с выводом команды htop:
  - отсортированному по PID, PERCENT_CPU, PERCENT_MEM, TIME
  - отфильтрованному для процесса sshd
  - с процессом syslog, найденным, используя поиск 
  - с добавленным выводом hostname, clock и uptime

  **== Выполнение ==**

  * Командой `top` запускаем утилиту, она установлена по умолчанию
  ![Запуск top](images/P9-1.png)

  * uptime
  ![uptime](images/P9-2.png)

  * Количество авторизованных пользователей
  ![uptime](images/P9-3.png)

  * Общая загрузка системы 
  ![uptime](images/P9-4.png)

  * Общее количество процессов
  ![tasks](images/P9-5.png)

  * загрузка cpu
  ![cpu](images/P9-6.png)

  * загрузка памяти
  ![mem](images/P9-7.png)

  * pid процесса, занимающего больше всего памяти
  ![pm](images/P9-8.png)
